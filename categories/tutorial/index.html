
  
<!doctype html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="siteBaseUrl" content="https://www.datarchy.tech/">
    <meta name="author" content="Wissem Belguidoum">
    <meta name="description" content="Wissem Belguidoum Data Engineer Datarchy">
    <meta name="keywords" content="blog, apache spark, dataframe, delta architecture, data lake, machine learning, data pipline, stream processing, apache flink, apache hadoop, data engineering, data engineer">
    <meta name="generator" content="Hugo 0.69.0" />
    <title>
        
           
               Tutorial &vert; Data Programmers
           
        
    </title>
    <meta name="description" content="Tutorial - Wissem Belguidoum Data Engineer Datarchy">
    <meta itemprop="name" content="Tutorial">
    <meta itemprop="description" content="Tutorial - Wissem Belguidoum Data Engineer Datarchy">
    <meta property="og:title" content="Tutorial">
    <meta property="og:description" content="Tutorial - Wissem Belguidoum Data Engineer Datarchy">
    <meta property="og:image" content="https://www.gravatar.com/avatar/d41d8cd98f00b204e9800998ecf8427e?size=200">
    <meta property="og:url" content="https://www.datarchy.tech/categories/tutorial/">
    <meta property="og:site_name" content="Data Programmers"><meta property="og:type" content="website">

    
	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
	<link rel="manifest" href="/site.webmanifest">
	<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
	<meta name="msapplication-TileColor" content="#da532c">
	<meta name="theme-color" content="#ffffff"> 

    <script src="/modernizr-simple.js"></script>

    
    <link href="/categories/tutorial/" rel="alternate" type="application/rss+xml" title="Data Programmers" />
    <link href="/categories/tutorial/" rel="feed" type="application/rss+xml" title="Data Programmers" />
    

    

    <link rel="stylesheet" href="https://www.datarchy.tech/theme.css">

    

    
        
            <link rel="stylesheet" href="https://www.datarchy.tech/datarchy.css">
        
    
</head>

<body class="bilberry-hugo-theme">

    
    <nav>

    <div class="container">
        <ul class="topnav">
            
                
                    <li><a href="https://www.datarchy.tech/page/about/">About</a></li>
                
            
                
                    <li><a href="https://www.linkedin.com/company/datarchy" target="_blank">LinkedIn</a></li>
                
            
        </ul>

        
    </div>
</nav>


    
    <header>

        <div class="container">
            <div class="logo">
                <a href="/" class="logo">
                    
                        <img src="/chrome-192x192.png" alt="">
                    

                    <span class="overlay"><i class="fa fa-home"></i></span>
                </a>
            </div>
            <div class="titles">
                <h3 class="title">
                    <a href="/">
                        Data Programmers
                    </a>
                </h3>

                
                    <span class="subtitle">Let&#39;s learn data engineering together!</span>
                
            </div>

            

            
                <div class="toggler">
            
                    <i class="fa fa-bars" aria-hidden="true"></i>
                </div>
            </div>
    </header>


    <div class="main container">
        
    
    
        <div class="article-wrapper u-cf">
            
                <a class="bubble" href="https://www.datarchy.tech/code/20200827_load_partitioned_json/">
    <i class="fas fa-fw fa-code"></i>
</a>

<article class="default article">
    
    <div class="featured-image">
        <a href="https://www.datarchy.tech/code/20200827_load_partitioned_json/">
            <img src="/spark_with_json.png" alt="">
        </a>
    </div>


    <div class="content">
    <h1 class="article-title">
        <a href="https://www.datarchy.tech/code/20200827_load_partitioned_json/">
            How to optimise loading partitioned JSON data in Spark ?
        </a>
    </h1>

    <div class="meta">
        
            
                <span class="date moment">2020-08-27</span>
            
        

        
            
                <span class="readingTime">6 min read</span>
            
        

        
            <span class="categories">
                
                    
                    
                        <a href="https://www.datarchy.tech/categories/apache-spark/">Apache Spark</a>
                    
                
                    
                    
                        <a href="https://www.datarchy.tech/categories/tutorial/">Tutorial</a>
                    
                
            </span>
        

        
            <span class="author">
                
                
                    <a href="https://www.datarchy.tech/author/wissem-belguidoum/">Wissem Belguidoum</a>
                
            </span>
        
    </div>

    
        In this tutorial we will explore ways to optimise loading partitioned JSON data in Spark.
I have used the SF Bay Area Bike Share dataset, you can find it here. The original data (status.csv) have gone through few transformations. The result looks like:
Loading from partitioned JSON files  We will load the data filtered by station and month :
val df1 = spark.read .json(&#34;file:///data/bike-data-big/partitioned_status.json&#34;) .filter(&#34;station_id = 10 and (month in (&#39;2013-08&#39;, &#39;2013-09&#39;))&#34;) Despite the fact that the code above does not contain any action yet, Spark starts three jobs that took few minutes to complete (on a local setting, with 8 cores and 32 Gigs or RAM):  Job 0 and Job 1 : Spark (and more specifically the Data Source API) is listing the content of the root folder and its subfolders, in order to discover the partitioning columns and map each column value to a path.

        
            <a href="https://www.datarchy.tech/code/20200827_load_partitioned_json/" class="more">Continue reading</a>
        
    
</div>

    
<div class="footer">


    
        <div class="tags">
            <i class="fa fa-tags"></i>
            <div class="links">
                
                    
                    
                    <a href="https://www.datarchy.tech/tags/spark/">Spark</a>
                    
                
                    
                    
                    <a href="https://www.datarchy.tech/tags/spark-dataframe/">Spark DataFrame</a>
                    
                
                    
                    
                    <a href="https://www.datarchy.tech/tags/json/">Json</a>
                    
                
            </div>
        </div>
    

    
</div>

</article>

            
        </div>
    
        <div class="article-wrapper u-cf">
            
                <a class="bubble" href="https://www.datarchy.tech/code/20200820_spark_rows_number/">
    <i class="fas fa-fw fa-code"></i>
</a>

<article class="default article">
    
    <div class="featured-image">
        <a href="https://www.datarchy.tech/code/20200820_spark_rows_number/">
            <img src="/Apache_Spark_logo.svg.png" alt="">
        </a>
    </div>


    <div class="content">
    <h1 class="article-title">
        <a href="https://www.datarchy.tech/code/20200820_spark_rows_number/">
            How to add row numbers to a Spark DataFrame?
        </a>
    </h1>

    <div class="meta">
        
            
                <span class="date moment">2020-08-20</span>
            
        

        
            
                <span class="readingTime">8 min read</span>
            
        

        
            <span class="categories">
                
                    
                    
                        <a href="https://www.datarchy.tech/categories/apache-spark/">Apache Spark</a>
                    
                
                    
                    
                        <a href="https://www.datarchy.tech/categories/tutorial/">Tutorial</a>
                    
                
            </span>
        

        
            <span class="author">
                
                
                    <a href="https://www.datarchy.tech/author/wissem-belguidoum/">Wissem Belguidoum</a>
                
            </span>
        
    </div>

    
        In this tutorial, we will explore a couple of ways to add a sequential consecutive row number to a dataframe.
For example, let this be our dataframe (taken from Spark: The Definitive Guide github repo):
val df = spark.read.option(&#34;header&#34;, &#34;true&#34;).csv(&#34;.../data/flight-data/csv/*&#34;) +-----------------+-------------------+-----+ |DEST_COUNTRY_NAME|ORIGIN_COUNTRY_NAME|count| +-----------------+-------------------+-----+ | United States| Romania| 1| | United States| Ireland| 264| | United States| India| 69| | Egypt| United States| 24| |Equatorial Guinea| United States| 1| +-----------------+-------------------+-----+ only showing top 5 rows After adding a column containing the row number, the result should look like:

        
            <a href="https://www.datarchy.tech/code/20200820_spark_rows_number/" class="more">Continue reading</a>
        
    
</div>

    
<div class="footer">


    
        <div class="tags">
            <i class="fa fa-tags"></i>
            <div class="links">
                
                    
                    
                    <a href="https://www.datarchy.tech/tags/spark/">Spark</a>
                    
                
                    
                    
                    <a href="https://www.datarchy.tech/tags/spark-dataframe/">Spark DataFrame</a>
                    
                
            </div>
        </div>
    

    
</div>

</article>

            
        </div>
    
        <div class="article-wrapper u-cf">
            
                <a class="bubble" href="https://www.datarchy.tech/code/20200814_spark_count_per_partition/">
    <i class="fas fa-fw fa-code"></i>
</a>

<article class="default article">
    
    <div class="featured-image">
        <a href="https://www.datarchy.tech/code/20200814_spark_count_per_partition/">
            <img src="/Apache_Spark_logo.svg.png" alt="">
        </a>
    </div>


    <div class="content">
    <h1 class="article-title">
        <a href="https://www.datarchy.tech/code/20200814_spark_count_per_partition/">
            Spark DataFrame - two ways to count the number of rows per partition
        </a>
    </h1>

    <div class="meta">
        
            
                <span class="date moment">2020-08-15</span>
            
        

        
            
                <span class="readingTime">2 min read</span>
            
        

        
            <span class="categories">
                
                    
                    
                        <a href="https://www.datarchy.tech/categories/apache-spark/">Apache Spark</a>
                    
                
                    
                    
                        <a href="https://www.datarchy.tech/categories/tutorial/">Tutorial</a>
                    
                
            </span>
        

        
            <span class="author">
                
                
                    <a href="https://www.datarchy.tech/author/wissem-belguidoum/">Wissem Belguidoum</a>
                
            </span>
        
    </div>

    
        Sometimes, we are required to compute the number of rows per each partition. To do this, there are two ways:
  The first way is using Dataframe.mapPartitions().
  The second way (the faster according to my observations) is using the spark_partition_id() function, followed by a grouping count aggregation.
  Let&rsquo;s first load the data into a dataframe I have used the SF Bay Area Bike data source, that can be found here

        
            <a href="https://www.datarchy.tech/code/20200814_spark_count_per_partition/" class="more">Continue reading</a>
        
    
</div>

    
<div class="footer">


    
        <div class="tags">
            <i class="fa fa-tags"></i>
            <div class="links">
                
                    
                    
                    <a href="https://www.datarchy.tech/tags/spark/">Spark</a>
                    
                
                    
                    
                    <a href="https://www.datarchy.tech/tags/dataframe/">DataFrame</a>
                    
                
            </div>
        </div>
    

    
</div>

</article>

            
        </div>
    

    
    <div class="paginator">
        

        
    </div>



    </div>

    
<footer>
    <div class="container">

        
        <div class="recent-posts">
            <strong>Latest posts</strong>
            <ul>
                
                
                    <li>
                        <a href="https://www.datarchy.tech/code/20200827_load_partitioned_json/">How to optimise loading partitioned JSON data in Spark ?</a>
                    </li>
                
                    <li>
                        <a href="https://www.datarchy.tech/code/20200820_spark_rows_number/">How to add row numbers to a Spark DataFrame?</a>
                    </li>
                
                    <li>
                        <a href="https://www.datarchy.tech/code/20200814_spark_count_per_partition/">Spark DataFrame - two ways to count the number of rows per partition</a>
                    </li>
                
            </ul>
        </div>
        

        
        <div class="categories">
            <a href="/categories/"><strong>Categories</strong></a>
            <ul>
                
                <li>
                    <a href="/categories/apache-spark">Apache spark
                        (3)</a>
                </li>
                
                <li>
                    <a href="/categories/tutorial">Tutorial
                        (3)</a>
                </li>
                
                <li>
                    <a href="/categories/motivation">Motivation
                        (1)</a>
                </li>
                
            </ul>
        </div>
        

        <div class="right">
            
            <div class="external-profiles">
                <strong>Social media</strong>

                
                <a href="https://www.linkedin.com/company/datarchy" target="_blank"><i class="fab fa-linkedin"></i></a>
                
                <a href="https://github.com/datarchy" target="_blank"><i class="fab fa-github"></i></a>
                
            </div>
            

            
        </div>
    </div>
</footer>


<div class="credits">
    <div class="container">
        <div class="copyright">
            <a href="https://github.com/datarchy" target="_blank">
                &copy;
                
                2020
                
                by Datarchy
            </a>
            -
            <a href="https://www.datarchy.tech/categories/tutorial/index.xml">RSS</a>
        </div>
        <div class="author">
            <a href="https://github.com/Lednerb/bilberry-hugo-theme"
                target="_blank"> </a>
        </div>
    </div>
</div>


    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-175071430-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


    


    <script type="text/javascript" src="https://www.datarchy.tech/theme.js"></script>

    
    
    

    
</body>

</html>
